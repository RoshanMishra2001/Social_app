<!DOCTYPE html>
<html lang="en" data-theme="{{ theme }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social App</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
    <style>
        .dark-mode {
            --bg-primary: #1a202c;
            --bg-secondary: #2d3748;
            --text-primary: #f7fafc;
            --text-secondary: #e2e8f0;
        }

        .light-mode {
            --bg-primary: #ffffff;
            --bg-secondary: #f7fafc;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .card {
            background-color: var(--bg-secondary);
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }

        .btn-primary {
            background-color: #4299e1;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 600;
        }

        .btn-primary:hover {
            background-color: #3182ce;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
    <!-- Navigation Bar -->
    <nav class="bg-white dark:bg-gray-800 shadow-md py-4">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <a href="/" class="text-2xl font-bold text-blue-600">SocialApp</a>

            <div class="flex items-center space-x-4">
                <a href="/" class="hover:text-blue-600">
                    <i class="fas fa-home"></i> Home
                </a>
                <a href="/profile" class="hover:text-blue-600">
                    <i class="fas fa-user"></i> Profile
                </a>
                <a href="/groups" class="hover:text-blue-600">
                    <i class="fas fa-users"></i> Groups
                </a>

                <!-- Theme Toggle -->
                <form hx-post="/api/theme" hx-trigger="change" hx-target="body" hx-swap="none" class="ml-4">
                    <input type="checkbox" name="theme" value="{{ 'light' if theme == 'dark' else 'dark' }}"
                           class="hidden" id="themeToggle">
                    <label for="themeToggle" class="cursor-pointer">
                        <i class="fas {{ 'fa-moon' if theme == 'light' else 'fa-sun' }}"></i>
                    </label>
                </form>

                <!-- User Menu -->
                <div class="relative group ml-4">
                    <button class="flex items-center space-x-2">
                        <img src="{{ user.profile_picture or '/static/default-profile.png' }}"
                             alt="Profile" class="w-8 h-8 rounded-full">
                        <span>{{ user.username }}</span>
                    </button>

                    <div class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-2 hidden group-hover:block z-10">
                        <a href="/profile" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-user mr-2"></i> Your Profile
                        </a>
                        <a href="/settings" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-cog mr-2"></i> Settings
                        </a>
                        <a href="/logout" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-sign-out-alt mr-2"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Left Sidebar -->
            <div class="lg:col-span-1 space-y-6">
                <!-- User Profile Card -->
                <div class="card p-6">
                    <div class="flex items-center space-x-4 mb-4">
                        <img src="{{ user.profile_picture or '/static/default-profile.png' }}"
                             alt="Profile" class="w-16 h-16 rounded-full">
                        <div>
                            <h3 class="font-bold">{{ user.username }}</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">{{ user.email }}</p>
                        </div>
                    </div>

                    <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                        <div class="flex justify-between text-sm">
                            <span>Posts</span>
                            <span class="font-bold">{{ user.posts|length if user.posts else 0 }}</span>
                        </div>
                        <div class="flex justify-between text-sm mt-2">
                            <span>Following</span>
                            <span class="font-bold">0</span> <!-- Placeholder -->
                        </div>
                        <div class="flex justify-between text-sm mt-2">
                            <span>Followers</span>
                            <span class="font-bold">0</span> <!-- Placeholder -->
                        </div>
                    </div>
                </div>

                <!-- Group Suggestions -->
                <div class="card p-6">
                    <h3 class="font-bold mb-4">Suggested Groups</h3>
                    <div class="space-y-4">
                        {% for group in group_suggestions %}
                        <div class="flex items-center space-x-3">
                            <img src="{{ group.cover_image or '/static/default-group.png' }}"
                                 alt="{{ group.name }}" class="w-10 h-10 rounded-full">
                            <div class="flex-1">
                                <h4 class="font-medium text-sm">{{ group.name }}</h4>
                                <p class="text-xs text-gray-600 dark:text-gray-400">
                                    {{ group.members|length }} members
                                </p>
                            </div>
                            <a href="/groups/{{ group.id }}" class="text-blue-600 hover:text-blue-800 text-sm">
                                View
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                    <a href="/groups" class="block text-center mt-4 text-blue-600 hover:text-blue-800 text-sm">
                        See all groups
                    </a>
                </div>
            </div>

            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Create Post Card -->
                <div class="card p-6">
                    <form hx-post="/api/posts" hx-encoding="multipart/form-data" hx-target="#posts-container"
                          hx-swap="afterbegin" class="space-y-4">
                        <div class="flex items-center space-x-3">
                            <img src="{{ user.profile_picture or '/static/default-profile.png' }}"
                                 alt="Profile" class="w-10 h-10 rounded-full">
                            <input type="text" name="title" placeholder="What's the title of your post?"
                                   class="flex-1 bg-gray-100 dark:bg-gray-700 rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>

                        <textarea name="content" rows="3" placeholder="What's on your mind?"
                                  class="w-full bg-gray-100 dark:bg-gray-700 rounded-lg p-4 focus:outline-none focus:ring-2 focus:ring-blue-500" required></textarea>

                        <div class="flex justify-between items-center">
                            <div class="flex space-x-4">
                                <label class="cursor-pointer">
                                    <i class="fas fa-image text-green-500"></i>
                                    <input type="file" name="media" accept="image/*,video/*" class="hidden">
                                </label>
                                <label class="cursor-pointer">
                                    <i class="fas fa-user-friends text-blue-500"></i>
                                    <select name="group_id" class="bg-gray-100 dark:bg-gray-700 rounded-md px-2 py-1 ml-1">
                                        <option value="">No Group</option>
                                        {% for group in user_groups if user_groups %}
                                        <option value="{{ group.id }}">{{ group.name }}</option>
                                        {% endfor %}
                                    </select>
                                </label>
                            </div>
                            <button type="submit" class="btn-primary">Post</button>
                        </div>
                    </form>
                </div>

                <!-- Posts Container -->
                <div id="posts-container" class="space-y-6">
                    {% for post in posts %}
                    <div class="card p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <img src="{{ post.owner.profile_picture or '/static/default-profile.png' }}"
                                     alt="{{ post.owner.username }}" class="w-10 h-10 rounded-full">
                                <div>
                                    <h3 class="font-bold">{{ post.owner.username }}</h3>
                                    <p class="text-xs text-gray-600 dark:text-gray-400">
                                        {{ post.created_at.strftime('%b %d, %Y at %H:%M') }}
                                        {% if post.group %}
                                        · <a href="/groups/{{ post.group.id }}" class="text-blue-600"> {{ post.group.name }}</a>
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                            <button class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>
                        </div>

                        <h2 class="text-xl font-semibold mb-2">{{ post.title }}</h2>
                        <p class="mb-4">{{ post.content }}</p>

                        {% if post.image_url %}
                        <img src="{{ post.image_url }}" alt="Post image" class="w-full rounded-lg mb-4">
                        {% endif %}

                        {% if post.video_url %}
                        <video src="{{ post.video_url }}" controls class="w-full rounded-lg mb-4"></video>
                        {% endif %}

                        <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-4">
                            <span>{{ post.likes|length }} likes</span>
                            <span>{{ post.comments|length }} comments</span>
                        </div>

                        <div class="border-t border-b border-gray-200 dark:border-gray-700 py-2 flex justify-between">
                            <button hx-post="/api/posts/{{ post.id }}/like" hx-target="closest .card"
                                    hx-swap="outerHTML" class="flex items-center space-x-2 hover:text-blue-600">
                                <i class="fas fa-thumbs-up {{ 'text-blue-600' if user.id in post.likes|map(attribute='user_id')|list else '' }}"></i>
                                <span>Like</span>
                            </button>
                            <button class="flex items-center space-x-2 hover:text-blue-600"
                                    onclick="document.getElementById('comment-{{ post.id }}').classList.toggle('hidden')">
                                <i class="fas fa-comment"></i>
                                <span>Comment</span>
                            </button>
                            <button hx-post="/api/posts/{{ post.id }}/share" hx-target="body"
                                    class="flex items-center space-x-2 hover:text-blue-600">
                                <i class="fas fa-share"></i>
                                <span>Share</span>
                            </button>
                        </div>

                        <!-- Comment Form -->
                        <div id="comment-{{ post.id }}" class="mt-4 hidden">
                            <form hx-post="/api/posts/{{ post.id }}/comment" hx-target="#comments-{{ post.id }}"
                                  hx-swap="afterbegin" class="flex space-x-2">
                                <img src="{{ user.profile_picture or '/static/default-profile.png' }}"
                                     alt="Profile" class="w-8 h-8 rounded-full">
                                <input type="text" name="content" placeholder="Write a comment..."
                                       class="flex-1 bg-gray-100 dark:bg-gray-700 rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <button type="submit" class="text-blue-600 font-semibold">Post</button>
                            </form>
                        </div>

                        <!-- Comments Section -->
                        <div id="comments-{{ post.id }}" class="mt-4 space-y-3">
                            {% for comment in post.comments %}
                            <div class="flex space-x-2">
                                <img src="{{ comment.user.profile_picture or '/static/default-profile.png' }}"
                                     alt="{{ comment.user.username }}" class="w-8 h-8 rounded-full">
                                <div class="flex-1 bg-gray-100 dark:bg-gray-700 rounded-lg p-3">
                                    <div class="flex justify-between items-start">
                                        <h4 class="font-bold text-sm">{{ comment.user.username }}</h4>
                                        <span class="text-xs text-gray-600 dark:text-gray-400">
                                            {{ comment.created_at.strftime('%b %d, %Y') }}
                                        </span>
                                    </div>
                                    <p class="text-sm">{{ comment.content }}</p>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="lg:col-span-1 space-y-6">
                <!-- People Suggestions -->
                <div class="card p-6">
                    <h3 class="font-bold mb-4">People You May Know</h3>
                    <div class="space-y-4">
                        {% for suggestion in suggestions %}
                        <div class="flex items-center space-x-3">
                            <img src="{{ suggestion.profile_picture or '/static/default-profile.png' }}"
                                 alt="{{ suggestion.username }}" class="w-10 h-10 rounded-full">
                            <div class="flex-1">
                                <h4 class="font-medium text-sm">{{ suggestion.username }}</h4>
                                <p class="text-xs text-gray-600 dark:text-gray-400">10 mutual friends</p> <!-- Placeholder -->
                            </div>
                            <button class="text-blue-600 hover:text-blue-800 text-sm">Add</button>
                        </div>
                        {% endfor %}
                    </div>
                    <button class="block w-full text-center mt-4 text-blue-600 hover:text-blue-800 text-sm">
                        See all suggestions
                    </button>
                </div>

                <!-- Trending Topics -->
                <div class="card p-6">
                    <h3 class="font-bold mb-4">Trending Topics</h3>
                    <div class="space-y-2">
                        <a href="#" class="block hover:text-blue-600">#Programming</a>
                        <a href="#" class="block hover:text-blue-600">#Technology</a>
                        <a href="#" class="block hover:text-blue-600">#SocialMedia</a>
                        <a href="#" class="block hover:text-blue-600">#WebDevelopment</a>
                        <a href="#" class="block hover:text-blue-600">#Python</a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Theme toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial theme based on cookie
            const theme = getCookie('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);

            // Handle theme toggle form submission
            document.querySelectorAll('form[hx-post="/api/theme"]').forEach(form => {
                form.addEventListener('change', function() {
                    // Update the theme immediately without waiting for server response
                    const newTheme = form.querySelector('input[name="theme"]').value;
                    document.documentElement.setAttribute('data-theme', newTheme);
                    document.cookie = `theme=${newTheme}; max-age=${365 * 24 * 60 * 60}; path=/`;
                });
            });

            // Helper function to get cookie value
            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
            }
        });
    </script>
</body>
</html>