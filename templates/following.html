<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
{% extends "base.html" %}

{% block title %}Followers - {{ profile_user.username }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-2xl mx-auto">
        <div class="bg-{% if theme == 'dark' %}gray-800{% else %}white{% endif %} rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-center justify-between mb-6">
                <h1 class="text-2xl font-bold text-{% if theme == 'dark' %}white{% else %}gray-800{% endif %}">
                    Followers
                </h1>
                <a href="/profile/{{ profile_user.username }}"
                   class="text-{% if theme == 'dark' %}blue-400{% else %}blue-600{% endif %} hover:underline">
                    Back to Profile
                </a>
            </div>

            {% if followers %}
            <div class="space-y-4">
                {% for follower in followers %}
                <div class="flex items-center justify-between p-4 border border-{% if theme == 'dark' %}gray-700{% else %}gray-200{% endif %} rounded-lg">
                    <div class="flex items-center space-x-4">
                        <img src="{{ follower.profile_picture or '/static/default_profile.png' }}"
                             alt="{{ follower.username }}"
                             class="w-12 h-12 rounded-full object-cover">
                        <div>
                            <a href="/profile/{{ follower.username }}"
                               class="font-semibold text-{% if theme == 'dark' %}white{% else %}gray-800{% endif %} hover:underline">
                                {{ follower.username }}
                            </a>
                            <p class="text-{% if theme == 'dark' %}gray-400{% else %}gray-600{% endif %} text-sm">
                                {{ follower.bio or "No bio yet" }}
                            </p>
                        </div>
                    </div>

                    {% if user.id != follower.id %}
                    <button onclick="toggleFollow({{ follower.id }})"
                            id="follow-btn-{{ follower.id }}"
                            class="px-4 py-2 rounded-full text-sm font-semibold
                                   {% if is_following(follower.id) %}
                                   bg-gray-200 text-gray-800
                                   {% else %}
                                   bg-blue-600 text-white
                                   {% endif %}">
                        {% if is_following(follower.id) %}Following{% else %}Follow{% endif %}
                    </button>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-8">
                <p class="text-{% if theme == 'dark' %}gray-400{% else %}gray-600{% endif %}">
                    No followers yet.
                </p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
async function toggleFollow(userId) {
    try {
        const response = await fetch(`/api/users/${userId}/follow`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
        });

        const result = await response.json();

        if (result.error) {
            alert(result.error);
            return;
        }

        const button = document.getElementById(`follow-btn-${userId}`);
        if (result.following) {
            button.textContent = 'Following';
            button.classList.remove('bg-blue-600', 'text-white');
            button.classList.add('bg-gray-200', 'text-gray-800');
        } else {
            button.textContent = 'Follow';
            button.classList.remove('bg-gray-200', 'text-gray-800');
            button.classList.add('bg-blue-600', 'text-white');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('An error occurred');
    }
}
</script>
{% endblock %}
</body>
</html>